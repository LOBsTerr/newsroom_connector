id: newsroom_item_document
label: Newsroom documents.
migration_group: newsroom
migration_tags:
  - newsroom_item

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: newsroom_simple_xml
  urls: 'https://ec.europa.eu/newsroom/dae/feed/full/new'

  item_selector: '//channel/item[enclosure[@nrdoctype="document" and not(@external_app="DocsRoom")]]'

  ids:
    item_id:
      type: integer

  fields:
    -
      name: item_id
      label: 'Item ID'
      selector: 'infsonewsroom:BasicId/text()'
    -
      name: title
      label: 'Title'
      selector: 'enclosure[@lang="EN" and @nrdoctype="document" and not(@external_app="DocsRoom")]/@title'
    -
      name: url
      label: 'URL'
      selector: 'enclosure[@lang="EN" and @nrdoctype="document" and not(@external_app="DocsRoom")]/@url'
    -
      name: is_machine_translated
      label: 'Is document machine translated'
      selector: 'enclosure[@lang="EN" and @nrdoctype="document" and not(@external_app="DocsRoom")]/@machineTranslation'

destination:
  plugin: 'entity:paragraph'

process:
  type:
    plugin: default_value
    default_value: newsroom_document

  'field_newsroom_documents/uri':
    plugin: get
    source: url

  'field_newsroom_documents/title':
    plugin: get
    source: title

  field_newsroom_is_machine_trans:
    plugin: get
    source: is_machine_translated

dependencies:
  enforced:
    module:
      - newsroom_connector_item
